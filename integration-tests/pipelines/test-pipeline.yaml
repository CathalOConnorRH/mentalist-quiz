apiVersion: tekton.dev/v1
kind: Pipeline
metadata:
  name: go-test-pipeline
spec:
  params:
    - description: 'Snapshot of the application'
      name: SNAPSHOT
      default: '{"components": [{"name":"test-app", "containerImage": "quay.io/example/repo:latest"}]}'
      type: string
  tasks:
    - name: test-metadata
      taskRef:
        resolver: git
        params:
        - name: url 
          value: https://github.com/dirgim/integration-examples
        - name: revision
          value: test-metadata
        - name: pathInRepo
          value: tasks/test_metadata.yaml
      params:
        - name: SNAPSHOT
          value: $(params.SNAPSHOT)
    - name: checkout-repo
      taskRef:
        resolver: git
        params:
        - name: url
          value: https://github.com/dheerajodha/the-mentalist-quiz
        - name: revision
          value: fix-tkn-task-of-ui-tests-n-make-konflux-compatible-workspaces
        - name: pathInRepo
          value: integration-tests/task/checkout-repo.yaml
      params:
        - name: source-git-url
          value: $(tasks.test-metadata.results.source-git-url)
        - name: source-git-revision
          value: $(tasks.test-metadata.results.source-git-revision)
      runAfter:
        - test-metadata
    - name: list-files
      runAfter:
        - checkout-repo
      taskRef:
        resolver: git
        params:
        - name: url 
          value: https://github.com/dheerajodha/the-mentalist-quiz
        - name: revision
          value: fix-tkn-task-of-ui-tests-n-make-konflux-compatible-workspaces
        - name: pathInRepo
          value: integration-tests/task/list-files.yaml
    - name: run-unit-tests
      runAfter:
        - list-files
      taskRef:
        resolver: git
        params:
        - name: url 
          value: https://github.com/dheerajodha/the-mentalist-quiz
        - name: revision
          value: fix-tkn-task-of-ui-tests-n-make-konflux-compatible-workspaces
        - name: pathInRepo
          value: integration-tests/task/run-unit-tests.yaml
    - name: build-app-binary
      runAfter:
        - run-unit-tests
      taskRef:
        resolver: git
        params:
        - name: url 
          value: https://github.com/dheerajodha/the-mentalist-quiz
        - name: revision
          value: fix-tkn-task-of-ui-tests-n-make-konflux-compatible-workspaces
        - name: pathInRepo
          value: integration-tests/task/build-app-binary.yaml
    - name: run-ui-tests
      runAfter:
        - build-app-binary
      taskRef:
        resolver: git
        params:
        - name: url 
          value: https://github.com/dheerajodha/the-mentalist-quiz
        - name: revision
          value: fix-tkn-task-of-ui-tests-n-make-konflux-compatible-workspaces
        - name: pathInRepo
          value: integration-tests/task/run-ui-tests.yaml
